var W=Object.defineProperty;var o=(e,s)=>W(e,"name",{value:s,configurable:!0});import{r as J}from"./get-pipe-path-BHW2eJdv.mjs";import d from"node:module";import h from"node:path";import{fileURLToPath as U}from"node:url";import{parseTsconfig as k,getTsconfig as Q,createFilesMatcher as z,createPathsMatcher as B}from"get-tsconfig";import G from"node:fs";import{b as H,i as X,a as K}from"./index-BQiEz0On.mjs";import{p as $}from"./client-BQVF1NaW.mjs";const j=Object.create(null);j[".js"]=[".ts",".tsx",".js",".jsx"],j[".jsx"]=[".tsx",".ts",".jsx",".js"],j[".cjs"]=[".cts"],j[".mjs"]=[".mts"];const w=o(e=>{const[s,t]=e.split("?"),a=h.extname(s),i=j[a];if(i){const l=s.slice(0,-a.length);return i.map(n=>l+n+(t?`?${t}`:""))}},"resolveTsPath"),V=o(e=>{const s=e.indexOf(":");if(s!==-1)return e.slice(0,s)},"getScheme"),L=o(e=>e[0]==="."&&(e[1]==="/"||e[1]==="."||e[2]==="/"),"isRelativePath"),Y=o(e=>L(e)||h.isAbsolute(e),"isUnixPath"),Z=o(e=>{if(Y(e))return!0;const s=V(e);return s&&s!=="node"},"requestAcceptsQuery"),F="file://",A=/\.([cm]?ts|[tj]sx)($|\?)/,q=/\.json($|\?)/,ee=/\/(?:$|\?)/,se=/^(?:@[^/]+\/)?[^/]+$/;let S,v,O=!1;const N=o(e=>{let s=null;if(e){const t=h.resolve(e);s={path:t,config:k(t)}}else{try{s=Q()}catch{}if(!s)return}S=z(s),v=B(s),O=s?.config.compilerOptions?.allowJs??!1},"loadTsconfig"),R=o(e=>Array.from(e).length>0?`?${e.toString()}`:"","urlSearchParamsStringify"),te=`${h.sep}node_modules${h.sep}`,C=o(e=>{if(!e.startsWith("data:text/javascript,"))return e;const s=e.indexOf("?");if(s===-1)return e;const t=new URLSearchParams(e.slice(s+1));let a=t.get("filePath");if(a){const i=t.get("namespace");i&&(a+=`?namespace=${encodeURIComponent(i)}`),d._cache[a]=d._cache[e],delete d._cache[e],e=a}return e},"interopCjsExports"),_=o((e,s,t)=>{if(!(t?.filename&&A.test(t.filename))&&!O)return;const a=w(s);if(a)for(const i of a)try{return e(i)}catch(l){const{code:n}=l;if(n!=="MODULE_NOT_FOUND"&&n!=="ERR_PACKAGE_PATH_NOT_EXPORTED")throw l}},"resolveTsFilename"),ne=[".ts",".tsx",".jsx"],b=o((e,s)=>{for(const t of ne)try{return e(s+t)}catch{}},"tryExtensions"),re=o((e,s)=>(t,a,i,l)=>{const n=o(c=>e(c,a,i,l),"resolve");t=C(t);const[m,g]=t.split("?"),u=new URLSearchParams(g);if(a?.filename){const r=new URLSearchParams(a.filename.split("?")[1]).get("namespace");r&&u.append("namespace",r)}if((u.get("namespace")??void 0)!==s)return n(t);const f=R(u);if(t=m,t.startsWith(F)&&(t=U(t)),v&&!L(t)&&!a?.filename?.includes(te)){const c=v(t);for(const r of c){const p=_(n,r,a);if(p)return p+f;try{return n(r)+f}catch{const P=b(n,r)||b(n,`${t}${h.sep}index`);if(P)return P+f}}}const x=_(n,t,a);if(x)return x+f;try{const c=n(t);return c+(h.isAbsolute(c)?f:"")}catch(c){const r=c;if(r.code==="MODULE_NOT_FOUND"&&typeof r.path=="string"&&r.path.endsWith("package.json")){const P=r.message.match(/^Cannot find module '([^']+)'$/);if(P){const E=P[1],y=_(n,E,a);if(y)return y+f}const T=r.message.match(/^Cannot find module '([^']+)'. Please verify that the package.json has a valid "main" entry$/);if(T){const E=T[1],y=_(n,E,a);if(y)return y+f}}const p=b(n,t)||b(n,`${t}${h.sep}index`);if(p)return p+f;throw r}},"createResolveFilename"),ae=`
//# sourceMappingURL=data:application/json;base64,`,D=o(()=>process.sourceMapsEnabled??!0,"shouldApplySourceMap"),M=o(({code:e,map:s})=>e+ae+Buffer.from(JSON.stringify(s),"utf8").toString("base64"),"inlineSourceMap"),oe=[".cts",".mts",".ts",".tsx",".jsx"],ce=[".js",".cjs",".mjs"],ie=o((e,s)=>{const t=Object.assign(Object.create(null),e),a=t[".js"],i=o((l,n)=>{const[m,g]=n.split("?");if((new URLSearchParams(g).get("namespace")??void 0)!==s)return a(l,m);$?.send&&$.send({type:"dependency",path:m});const f=oe.some(r=>m.endsWith(r)),x=ce.some(r=>m.endsWith(r));if(!f&&!x)return a(l,m);let c=G.readFileSync(m,"utf8");if(m.endsWith(".cjs")){const r=H(n,c);r&&(c=D()?M(r):r.code)}else if(f||X(c)){const r=K(c,n,{tsconfigRaw:S?.(m)});c=D()?M(r):r.code}l._compile(c,m)},"transformer");return t[".js"]=i,[".ts",".tsx",".jsx"].forEach(l=>{const n=Object.getOwnPropertyDescriptor(t,l);Object.defineProperty(t,l,{value:i,enumerable:n?.enumerable||!s})}),Object.defineProperty(t,".mjs",{value:i,enumerable:!1}),t},"createExtensions"),I=o((e,s)=>{if(!s)throw new Error("The current file path (__filename or import.meta.url) must be provided in the second argument of tsx.require()");return(typeof s=="string"&&s.startsWith("file://")||s instanceof URL)&&(s=U(s)),h.resolve(h.dirname(s),e)},"resolveContext"),le=o(e=>{const{sourceMapsEnabled:s}=process,{_extensions:t,_resolveFilename:a}=d;N(process.env.TSX_TSCONFIG_PATH),process.setSourceMapsEnabled(!0);const i=re(a,e?.namespace);d._resolveFilename=i;const l=ie(d._extensions,e?.namespace);d._extensions=l;const n=o(()=>{s===!1&&process.setSourceMapsEnabled(!1),d._extensions=t,d._resolveFilename=a},"unregister");if(e?.namespace){const m=o((u,f)=>{const x=I(u,f),[c,r]=x.split("?"),p=new URLSearchParams(r);return e.namespace&&p.set("namespace",e.namespace),J(c+R(p))},"scopedRequire");n.require=m;const g=o((u,f,x)=>{const c=I(u,f),[r,p]=c.split("?"),P=new URLSearchParams(p);return e.namespace&&P.set("namespace",e.namespace),i(r+R(P),module,!1,x)},"scopedResolve");n.resolve=g,n.unregister=n}return n},"register");export{q as a,M as b,Z as c,ee as d,se as e,S as f,O as g,F as h,C as i,w as j,v as k,N as l,le as r,A as t};
